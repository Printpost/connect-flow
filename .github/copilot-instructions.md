# Copilot Instructions
- **Run Context**: React 18 on Vite 6 with Tailwind. The alias `@` maps to `src/` (vite.config.js, jsconfig.json) and JSX files expect Tailwind classes so the visual editor can diff reliably.
- **App Bootstrap**: `src/main.jsx` mounts `App.jsx`, hooks HMR events (`sandbox:beforeUpdate/afterUpdate`) for the parent iframe, and loads global styles from `index.css`.
- **Providers & Auth**: `App.jsx` layers `AuthProvider`, React Query (`queryClientInstance`), and React Router before rendering `Toaster` + `VisualEditAgent`. `lib/AuthContext.jsx` uses `appParams` + `@base44/sdk` to fetch public app settings with `createAxiosClient`, checks `isLoadingPublicSettings/isLoadingAuth`, and renders `UserNotRegisteredError` or redirects on `auth_required`.
- **App Params**: `lib/app-params.js` persists `app_id`, `server_url`, and `access_token` from the iframe query string into localStorage and strips sensitive params from the URL when requested. Keep those storage keys and mutation order intact to avoid breaking re-auth flows.
- **Routing Contract**: `src/pages.config.js` exposes `pagesConfig` with `Pages`, `Layout`, and `mainPage`. Keys become URL slugs via the `createPageUrl` helper in `utils/index.ts` (lowercase, spaces → hyphens). Register new screens here and keep `Layout.jsx` navigation in sync.
- **Layout Shell**: `Layout.jsx` wires the Shadcn sidebar primitives, applies CSS variables via an inline `<style>`, and mounts the floating `ChatSupport` widget. Avoid Fragment-only returns that would drop the required sidebar provider context.
- **Navigation Telemetry**: `lib/NavigationTracker.jsx` posts `app_changed_url` to the parent and, when authenticated, logs `base44.appLogs.logUserInApp(pageName)`. It matches routes case-insensitively against `pagesConfig` keys—keep that lookup accurate if you rename slugs.
- **Iframe Messaging**: `lib/iframe-messaging.js` registers `app_error` forwarding for `unhandledrejection` and `error`. Combined with the patched overlay in `vite-plugins/error-overlay-plugin.js`, this keeps the sandbox host informed—do not alter message shapes.
- **Error Surfacing**: `vite-plugins/error-overlay-plugin.js` swaps Vite's overlay to `ErrorOverlay.js`, which posts structured errors to the parent frame. Keep that override paired with `setupIframeMessaging()` so sandbox hosts see failures.
- **Visual Editor Contract**: `vite-plugins/visual-edit-plugin.js` injects `data-source-location`/`data-dynamic-content` attributes and a Tailwind CDN tag. `lib/VisualEditAgent.jsx` depends on those markers to highlight nodes and merge class updates with `twMerge`; avoid removing attributes or wrapping outputs in plain Fragments.
- **Data Access Pattern**: All Base44 calls go through `src/api/base44Client.js`/`integrations.js`. Use `useQuery` with explicit `queryKey`s (see `pages/Dashboard.jsx`) and seed `initialData` for mock-friendly UIs. The JSON schemas under `src/entities/` inform both SDK typing and UI assumptions—update both when fields change.
- **Base44 Client**: `src/api/base44Client.js` builds the SDK client with `requiresAuth: false` so pages can render before login; only call methods that demand auth after `useAuth()` reports `isAuthenticated`.
- **Campaign Builder Modules**: Complex channel flows live under `components/campaign/` (`CampaignPreview`, `ChannelSelector`, `RecipientSelector`, etc.). Reuse these to keep validation toggles, preview logic, and seeded mock data aligned across pages like `NovaCampanha.jsx`, `Automacoes.jsx`, and `DetalhamentoCampanha.jsx`.
- **UI & Motion**: `src/components/ui/` contains pre-themed Shadcn primitives; combine them with Tailwind gradients/glassmorphism. Framer Motion (`motion`, `AnimatePresence`) drives list/card entrance animations and floating widgets (Dashboard stats, ChatSupport, campaign previews).
- **Environment Expectations**: Vite dev server is container-ready (`server.host=0.0.0.0`, `strictPort: true`, WSS HMR on port 443, polling watcher). Use `npm run dev`, `npm run build`, `npm run preview`, `npm run lint`, and `npm run typecheck`. `jsconfig.json` limits type coverage to select folders, so manual review is needed for `lib/` or API helpers.
- **Sandbox Headers**: `vite.config.js` adds an `iframe-hmr` middleware that sets `X-Frame-Options: ALLOWALL` and a permissive CSP so the app can be embedded; preserve those headers when adjusting server config.
- **Responsive Patterns**: Prefer shared hooks like `hooks/use-mobile.jsx` for breakpoint checks over window listeners; Tailwind utility combos handle most responsiveness.
- **Assets & Remote Media**: Local assets sit in `src/assets/`, but many UIs reference Supabase-hosted URLs (see `Layout.jsx`). Verify external URLs before swapping.
- **Testing Reality**: No automated tests exist. Validate critical flows by exercising the iframe sandbox (watch for `app_error` events in DevTools) and confirming `sandbox:beforeUpdate/afterUpdate` still fire during HMR.
- **Troubleshooting Tip**: When something breaks, trace from the route component → shared widget → Base44 SDK call, ensuring each layer preserves the `data-*` attributes and postMessage hooks the host expects.
